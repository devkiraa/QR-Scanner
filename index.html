<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>QR Code Scanner Web App</title>
</head>
<body>
   <h1>QR Code Scanner</h1>
   <video id="qr-video" width="100%" height="auto"></video>
   <p>Scanned Data: <span id="scanned-data"></span></p>

   <!-- Include the jsQR library just before the closing </body> tag -->
   <script src="https://cdn.jsdelivr.net/npm/jsqr@1.0.0/dist/jsQR.js"></script>

   <!-- Your custom JavaScript code -->
   <script>
       const video = document.getElementById('qr-video');
       const scannedDataElement = document.getElementById('scanned-data');

       // Use getUserMedia to access the webcam
       navigator.mediaDevices
           .getUserMedia({ video: { facingMode: 'environment' } }) // Use the device's rear camera
           .then(function (stream) {
               video.srcObject = stream;
               video.play();
               scanQRCode();
           })
           .catch(function (error) {
               console.error('Error accessing the webcam:', error);
           });

       function scanQRCode() {
           const canvas = document.createElement('canvas');
           const context = canvas.getContext('2d');

           // Continuously scan for QR codes
           function checkForQRCode() {
               if (video.readyState === video.HAVE_ENOUGH_DATA) {
                   canvas.width = video.videoWidth;
                   canvas.height = video.videoHeight;
                   context.drawImage(video, 0, 0, canvas.width, canvas.height);

                   const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                   const code = jsQR(imageData.data, imageData.width, imageData.height);

                   if (code) {
                       const scannedData = code.data;
                       scannedDataElement.textContent = scannedData;
                       
                       // Send scanned data to Google Sheets
                       sendQRDataToGoogleSheets(scannedData);
                   }
               }
               requestAnimationFrame(checkForQRCode);
           }

           checkForQRCode();
       }

       // Function to send scanned data to Google Sheets
       function sendQRDataToGoogleSheets(data) {
           fetch('https://script.google.com/macros/s/AKfycbwZKaEooLR5m7WM_97UCQBJ60ExulEYsRmEVMDn4O1XXDUGHxaDjTDX40qqhspJb0i9Qg/exec', { // Replace with your web app URL
               method: 'POST',
               headers: {
                   'Content-Type': 'application/json',
               },
               body: JSON.stringify({ qrData: data }),
           })
           .then(response => response.text())
           .then(result => {
               console.log(result);
           })
           .catch(error => {
               console.error('Error sending QR data:', error);
           });
       }
   </script>
</body>
</html>
