<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>QR Code Scanner Web App</title>
</head>
<body>
   <h1>QR Code Scanner</h1>
   <video id="qr-video" width="100%" height="auto"></video>
   <p>Scanned Data: <span id="scanned-data"></span></p>
   <button id="capture-button">Capture</button>
   <button id="send-button" style="display: none;">Send to Python Backend</button>
   <p id="send-status"></p>

   <!-- Include the jsQR library just before the closing </body> tag -->
   <script src="https://cdn.jsdelivr.net/npm/jsqr@1.0.0/dist/jsQR.js"></script>

   <!-- Your custom JavaScript code -->
   <script>
       const video = document.getElementById('qr-video');
       const scannedDataElement = document.getElementById('scanned-data');
       const captureButton = document.getElementById('capture-button');
       const sendButton = document.getElementById('send-button');
       const sendStatus = document.getElementById('send-status');
       let isCaptured = false;

       // Use getUserMedia to access the webcam
       navigator.mediaDevices
           .getUserMedia({ video: { facingMode: 'environment' } }) // Use the device's rear camera
           .then(function (stream) {
               video.srcObject = stream;
               video.play();
           })
           .catch(function (error) {
               console.error('Error accessing the webcam:', error);
           });

       captureButton.addEventListener('click', captureImage);
       sendButton.addEventListener('click', sendImageToPythonBackend);

       function captureImage() {
           if (!isCaptured) {
               isCaptured = true;
               captureButton.textContent = 'Recapture'; // Change button text
               sendButton.style.display = 'none'; // Hide the "Send to Python Backend" button
               sendStatus.textContent = ''; // Clear send status

               // Your QR code scanning logic using jsQR library goes here
               // Once you have the scanned QR code data, set it to scannedDataElement

               // Example:
               const scannedData = 'QR Code Data'; // Replace with the actual scanned data
               scannedDataElement.textContent = scannedData;
               sendButton.style.display = 'block'; // Show the "Send to Python Backend" button
           } else {
               // If already captured, allow recapturing
               isCaptured = false;
               captureButton.textContent = 'Capture'; // Reset button text
               sendButton.style.display = 'none'; // Hide the "Send to Python Backend" button
               scannedDataElement.textContent = ''; // Clear scanned data
               sendStatus.textContent = ''; // Clear send status
           }
       }

       function sendImageToPythonBackend() {
           if (isCaptured) {
               // Get the scanned data
               const scannedData = scannedDataElement.textContent;

               // Send the scanned data to the Python backend using fetch
               fetch('/your-python-endpoint', {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify({ qrData: scannedData }),
               })
               .then(response => response.text())
               .then(result => {
                   console.log(result);
                   sendStatus.textContent = 'Data sent to Python Backend successfully.';
               })
               .catch(error => {
                   console.error('Error sending data to Python Backend:', error);
                   sendStatus.textContent = 'Error sending data to Python Backend.';
               });
           } else {
               alert('Please capture an image first.');
           }
       }
   </script>
</body>
</html>
